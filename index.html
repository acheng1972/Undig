<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sultan Wedding Ultimate Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --dark: #0A0A0A; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Playfair Display', serif; background: var(--dark); color: #fff; overflow-x: hidden; }
        #builder { padding: 20px; max-width: 600px; margin: 20px auto; border: 2px solid var(--gold); background: #111; border-radius: 12px; position: relative; z-index: 1000; }
        .group { margin-bottom: 12px; }
        label { display: block; color: var(--gold); font-size: 10px; font-weight: bold; text-transform: uppercase; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: #fff; border-radius: 6px; }
        .btn-build { width: 100%; padding: 14px; margin-top: 10px; border: none; font-weight: bold; cursor: pointer; border-radius: 6px; text-transform: uppercase; }
        #app { display: none; width: 100vw; height: 100vh; position: relative; background: var(--dark); overflow: hidden; }
        .page { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .page.active { display: flex; animation: fadeIn 0.8s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .glass { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(212, 175, 55, 0.3); padding: 30px; border-radius: 25px; width: 90%; max-width: 450px; }
        h1 { font-family: 'Great Vibes', cursive; color: var(--gold); font-size: 2.8rem; }
        .t-gold { color: var(--gold); font-weight: bold; text-shadow: 2px 2px 4px #000; }
        #d-ini-v { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 35px; font-size: 1.8rem; color: var(--gold); font-family: 'Great Vibes', cursive; line-height: 1.2; text-align: center; z-index: 100; text-shadow: 2px 2px 5px #000; }
        #p1 { background-size: cover; background-position: center; }
        #p1::after { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.4); }
        #p1 > * { z-index: 1; position: relative; }
        #tamu-container { position: absolute; top: 80px; width: 100%; text-align: center; z-index: 100; }
        video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; }
        #nav { position: fixed; bottom: 30px; right: 30px; display: none; z-index: 500; }
        .nav-b { width: 55px; height: 55px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #000; cursor: pointer; font-size: 24px; box-shadow: 0 5px 15px var(--gold); }
        #btn-back-edit { position: fixed; top: 15px; right: 15px; background: #e74c3c; color: white; padding: 6px 12px; border-radius: 5px; cursor: pointer; z-index: 2000; display: none; font-weight: bold; border: none; font-size: 11px; }
        .btn-maps { display: block; background: var(--gold); color: #000; padding: 15px; border-radius: 50px; font-weight: bold; text-decoration: none; margin-top: 25px; }
    </style>
</head>
<body>
<button id="btn-back-edit" onclick="backToEdit()">EDIT ULANG</button>
<div id="builder">
    <h2 style="color:var(--gold); text-align:center; margin-bottom:15px;">Sultan Wedding Builder</h2>
    <div class="group"><label>Nama Tamu</label><input id="i-tamu" value="Keluarga Besar Bpk. Jajang"></div>
    <div class="group"><label>Inisial (Pria Spasi Wanita)</label><input id="i-ini" value="R R"></div>
    <div style="display:flex; gap:10px;"><input id="i-pria" value="Bang Redo" placeholder="Pria"><input id="i-op" value="Bpk. Andi & Ibu Siti" placeholder="Ortu Pria"></div>
    <div style="display:flex; gap:10px; margin-top:8px;"><input id="i-wanita" value="Neng Rara" placeholder="Wanita"><input id="i-ow" value="Bpk. Budi & Ibu Ani" placeholder="Ortu Wanita"></div>
    <div class="group" style="margin-top:10px;"><label>Our Journey</label><textarea id="i-jor">Pertemuan yang membawa kita pada ikatan suci.</textarea></div>
    <div class="group"><label>Waktu Acara</label><input id="i-tgl" value="Minggu, 24 Mei 2026 | 09.00 WIB"></div>
    <div class="group"><label>Alamat Lengkap</label><input id="i-jal" value="The Sultan Hotel & Residence, Jakarta"></div>
    <div class="group"><label>Link Maps (https://)</label><input id="i-map" value=""></div>
    <div class="group"><label>Upload Media (4MB OK)</label>
        <input type="file" id="f-bg" accept="image/*"><br>
        <input type="file" id="f-vd" accept="video/mp4" style="margin-top:5px;"><br>
        <input type="file" id="f-ms" accept="audio/mp3" style="margin-top:5px;">
    </div>
    <button class="btn-build" style="background:var(--gold); color:#000;" onclick="pre()">PREVIEW</button>
    <button class="btn-build" style="background:#fff; color:#000;" onclick="dl()">DOWNLOAD HTML</button>
</div>

<div id="app">
    <div class="page active" id="p1">
        <div id="d-ini-v"></div>
        <div id="tamu-container">
            <p class="t-gold" style="letter-spacing:3px; font-size:11px;">KEPADA YTH:</p>
            <h3 id="d-tamu" class="t-gold" style="font-size:1.7rem; margin-top: 5px;"></h3>
        </div>
        <div style="height:100vh; display:flex; flex-direction:column; justify-content:flex-end; padding-bottom:60px;">
            <div style="background:var(--gold); color:#000; padding:18px 40px; border-radius:50px; font-weight:bold; cursor:pointer; box-shadow: 0 0 20px rgba(0,0,0,0.6);" onclick="st()">üîí BUKA UNDANGAN</div>
        </div>
    </div>
    <div class="page" id="p2" style="background:#050505"><div class="glass"><p style="font-style:italic;">‚ÄúDan di antara tanda-tanda (kebesaran)-Nya ialah Dia menciptakan untukmu pasangan-pasangan...‚Äù</p><p class="t-gold" style="margin-top: 20px;">‚Äî QS. Ar-Rum: 21</p></div></div>
    <div class="page" id="p3"><video id="v-jorn" loop muted playsinline></video><div style="position:absolute; bottom:0; width:100%; padding:60px 20px; background:linear-gradient(transparent, rgba(0,0,0,0.95) 70%);"><h1>Our Journey</h1><p id="d-jor"></p></div></div>
    <div class="page" id="p4" style="background:#050505"><div class="glass"><h1 id="d-pria"></h1><p style="font-size:10px;">Putra dari:</p><p id="d-op" class="t-gold" style="margin-bottom:15px;"></p><h1>&</h1><h1 id="d-wanita"></h1><p style="font-size:10px;">Putri dari:</p><p id="d-ow" class="t-gold"></p></div></div>
    <div class="page" id="p5" style="background:#000"><div class="glass"><h2 class="t-gold">SAVE THE DATE</h2><p id="d-tgl" style="margin:20px 0; font-weight:bold;"></p><h3 id="d-gedung-p5" class="t-gold"></h3><a id="link-maps" href="#" target="_blank" class="btn-maps">üìç LIHAT LOKASI MAPS</a></div></div>
    <div class="page" id="p6" style="background:#050505"><div class="glass"><h1>Terima Kasih</h1><p style="margin:20px 0; font-size:14px; line-height:1.6;">Merupakan kehormatan dan kebahagiaan bagi kami apabila Bapak/Ibu berkenan hadir memberikan doa restu.</p><p class="t-gold" style="margin-top:25px;">Kami yang berbahagia,</p><h2 id="d-ini-e" style="font-family:'Great Vibes'; color:var(--gold); font-size:3.5rem;"></h2></div></div>
    <div id="nav"><div class="nav-b" onclick="nx()">‚Üí</div></div>
</div>

<audio id="m-bg" loop preload="auto"></audio>
<script>
    let cur = 1, res = { bg: '', vd: '', ms: '' };
    const $ = (id) => document.getElementById(id);
    
    // Fungsi pembaca file agar masuk ke object res
    const read = (id, k) => { 
        const f = $(id).files[0]; 
        if(f){ 
            const r = new FileReader(); 
            r.onload = (e) => {
                res[k] = e.target.result;
                if(k === 'ms') { $('m-bg').src = e.target.result; $('m-bg').load(); }
                if(k === 'vd') { $('v-jorn').src = e.target.result; }
            }; 
            r.readAsDataURL(f); 
        }
    };

    $('f-bg').onchange = () => read('f-bg', 'bg');
    $('f-vd').onchange = () => read('f-vd', 'vd');
    $('f-ms').onchange = () => read('f-ms', 'ms');

    function pre() {
        $('d-tamu').innerText = $('i-tamu').value;
        $('d-ini-v').innerHTML = $('i-ini').value.split(" ").join("<br>&<br>");
        $('d-ini-e').innerText = $('i-ini').value;
        $('d-pria').innerText = $('i-pria').value;
        $('d-wanita').innerText = $('i-wanita').value;
        $('d-op').innerText = $('i-op').value;
        $('d-ow').innerText = $('i-ow').value;
        $('d-jor').innerText = $('i-jor').value;
        $('d-tgl').innerText = $('i-tgl').value;
        $('d-gedung-p5').innerText = $('i-jal').value;
        
        let ml = $('i-map').value.trim();
        $('link-maps').href = ml.startsWith('http') ? ml : "https://www.google.com/maps/search/" + encodeURIComponent($('i-jal').value);
        
        if(res.bg) $('p1').style.backgroundImage = `url(${res.bg})`;
        
        $('builder').style.display='none'; $('app').style.display='block'; $('btn-back-edit').style.display='block';
        resetToPage(1);
    }

    function st() { 
        const m = $('m-bg');
        if (m.src) {
            m.play().catch(e => console.log("Interaksi diperlukan untuk audio"));
        }
        $('nav').style.display='block'; 
        nx(); 
    }

    function nx() { 
        $(`p${cur}`).classList.remove('active'); 
        cur = (cur < 6) ? cur + 1 : 1; 
        $(`p${cur}`).classList.add('active'); 
        
        if(cur===3) $('v-jorn').play(); else $('v-jorn').pause();
        if(cur===1) $('nav').style.display='none'; 
    }

    function backToEdit() { 
        $('app').style.display='none'; 
        $('builder').style.display='block'; 
        $('btn-back-edit').style.display='none'; 
        $('m-bg').pause(); 
    }

    function resetToPage(n) { 
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); 
        $(`p${n}`).classList.add('active'); 
        cur = n; 
        $('nav').style.display='none'; 
    }

    function dl() { 
        pre(); 
        const c = document.documentElement.cloneNode(true);
        
        // 1. Ambil source media agar tetap jalan di file download
        c.querySelector('#m-bg').src = $('m-bg').src;
        c.querySelector('#v-jorn').src = $('v-jorn').src;
        if(res.bg) c.querySelector('#p1').style.backgroundImage = `url(${res.bg})`;
        
        // 2. Bersihkan tampilan editor
        c.querySelector('#builder').remove(); 
        c.querySelector('#btn-back-edit').remove(); 
        c.querySelector('#app').style.display='block'; 

        // 3. SUNTIKKAN SCRIPT PINTAR (URL Parameter Reader)
        // Script ini akan otomatis jalan di file hasil download luh
        const smartScript = document.createElement('script');
        smartScript.innerHTML = `
            window.addEventListener('DOMContentLoaded', () => {
                const params = new URLSearchParams(window.location.search);
                const tamu = params.get('to');
                if (tamu) {
                    const target = document.getElementById('d-tamu');
                    if (target) {
                        target.innerText = decodeURIComponent(tamu).replace(/\\+/g, ' ');
                    }
                }
            });
        `;
        c.body.appendChild(smartScript);
        
        // 4. Proses Download
        const b = new Blob(["<!DOCTYPE html>\n"+c.outerHTML], {type:"text/html"});
        const a = document.createElement('a'); 
        a.href = URL.createObjectURL(b); 
        a.download = "Undangan_Sultan_Final.html"; 
        a.click(); 
        backToEdit(); 
    }
</script>
</body>
</html>